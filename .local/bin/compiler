#!/bin/sh

file=$(readlink -f "$1")
dir=${file%/*}
ext="${file##*.}"
filename="${file##*/}"
jname="${filename%.*}"

[ "$filename" = 'ms-macros.ms' ] && exit 0

is_alive(){ ps aux | grep -i "$1" | grep -qv 'grep'; }
open_pdf(){ is_alive "${jname}.pdf" || \
	{ [ -f "$dir/${jname}.pdf" ] && $READER "$dir/${jname}.pdf" > /dev/null 2>&1 & }
}

groff_ms_sub(){ groff -mspdf -U -tepR -T$1 -P-pa4 "$file"; }
groff_ms(){
	if grep -q '^.PSPIC' "$file"; then
		groff_ms_sub ps | ps2pdf - "$dir/$jname.pdf"
	else
		groff_ms_sub pdf > "$dir/$jname.pdf"
		sound-efx &
	fi
}

		[ -d "$dir" ] || exit 1

case "$ext" in
	ms) groff_ms ;;
	#ms) groff -mspdf -U -tepR -Tps -P-pa4 "$file" | ps2pdf - "$dir/$jname.pdf" ;;
esac

open_pdf
