#!/bin/sh

REPO="git@github.com:SymphonySimper/bmark.git"
REPO_PARENT_LOC="$(echo $BMARK | sed 's/bmark\/bookmarks//g')"
REPO_LOC="$(echo $BMARK | sed 's/bookmarks//g')"

err(){ echo "$(syl r; syl B)${1}$(syl R)"; }
succ(){ echo "$(syl g; syl B)${1}$(syl R)"; }

sort_bmark(){ sort $BMARK -o $BMARK; }
add_bmark(){
	if grep -qw "^$1" $BMARK; then
		err "$1 already exists"
	else
		printf "%*s %s\n" -24 "$1" "$2" >> $BMARK
		succ "$1 added to Bookmarks"
		sort_bmark
	fi
}
rm_bmark(){
	if grep -qw "^$1" $BMARK; then
		sed "/^$1/d" -i $BMARK
		succ "$1 deleted"
		sort_bmark
	else
		err "Bookmark $1 not found"
	fi
}
clone_repo(){
	if [ -f "$HOME"/.ssh/id*.pub ]; then
		git -C $REPO_PARENT_LOC clone $REPO
	fi
}
push_repo(){
	if git -C $REPO_LOC status | grep -q 'modified'; then
		git -C $REPO_LOC add -u \
		&& git -C $REPO_LOC commit -m "$1" \
		&& git -C $REPO_LOC push
	else
		succ "Nothing to commit"
	fi
}
status_repo(){ git -C $REPO_LOC status -v; }

if [ ! -d $REPO_LOC ]; then
	err "$BMARK does not exist"
	read -p "Would you like to clone it? [Y/n]" ANS
	case "$ANS" in
		[yY]*) clone_repo ;;
		[nN]*) exit 1 ;;
		*) clone_repo ;;
	esac
fi
case "$1" in
	add) shift; add_bmark "$1" "$2" ;;
	rm) shift; rm_bmark "$1" ;;
	edit) $EDITOR $BMARK; sort_bmark ;;
	clone) clone_repo ;;
	status) status_repo ;;
	push) shift; push_repo "$1" ;;
	*) err "Invalid argument" ;;
esac
