#!/bin/sh

# pgrep picom && killall picom || picom -m 1.0 -i 1.0 -e 1.0 --vsync --backend glx --no-fading-openclose &

notify="dunstify -h string:x-dunst-stack-tag:picom"
notify2="dunstify -h string:x-dunst-stack-tag:capsToEscape"

isPicom="$(pgrep picom)"
isActive="$(systemctl --user is-active touchcursor.service)"

service(){ systemctl --user "$1" touchcursor.service; } 
capsToEsc(){ setxkbmap -option caps:escape; }

if [ -z "$isPicom" -a "$isActive" = 'inactive' ]; then
	picom > /dev/null 2>&1 &
	service "start"
	$notify "Picom is alive"
	sleep 1s
	capsToEsc &&
	$notify2 "Capls lock remapped to Escape"
elif [ -n "$isPicom" -a "$isActive" = 'active' ]; then
	killall picom &&
	service "stop" &&
	capsToEsc &&
	$notify "Picom is dead"
fi
