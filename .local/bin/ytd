#!/bin/sh

bold=$(syl B); reset=$(syl R); yellow=$(syl y)
qn(){ echo "\n${bold}${yellow}${1}${reset}"; }

vLoc='~/importantnt/video/%(title)s.%(ext)s'
aLoc='~/importantnt/audio/%(title)s.%(ext)s'

ytdl="youtube-dl"
getF(){ format=$($ytdl -F "$1") > /dev/null 2>&1; }
dF(){ echo "$format" | grep "$1" | sed "s/\,.*//"; }
getC(){ dF "$1" | tail -n 1 | cut -d ' ' -f 1; }

av(){
	case "$1" in
		-a) shift; dF 'audio'
			qn "Enter audio format"
			read af; echo ;;
		-v) shift; dF 'video' 
			qn "Enter video format"
			read vf; echo ;;
	esac
}

dl(){ $ytdl "$1" -o $vLoc; }

echo
case "$1" in 
	-a) shift
		getF "$1"
		af=$(getC 'audio')
		$ytdl -f "$af" "$1" -o $aLoc ;;
	-v) shift
		getF "$1"
		af=$(getC 'audio')
		av -v
		$ytdl -f "$vf+$af" "$1" -o $vLoc ;;
	-sa) shift
		getF "$1"
		av -a
		$ytdl -f "$af" "$1" -o $aLoc ;;
	-s) shift 
		getF "$1"
		av -a; av -v;
		$ytdl -f "$vf+$af" "$1" -o $vLoc ;;
	*playlist*)
		qn "You're about to download a playlist"
		echo "If you don't want to download cancel within 5s"
		echo
		sleep 5s
		dl "$1" ;;
	*) dl "$1";;
esac
