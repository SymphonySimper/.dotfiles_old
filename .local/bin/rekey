#!/bin/sh

prgm="sxhkd"

loc="$HOME"/.config/sxhkd
bspwmKey="$loc"/bspwmhotkeys
myBspwmBinds="$loc"/myBspwmBinds
myKey="$loc"/mybinds

configLoc="$loc"/.sxhkdrc

xLoc="$HOME"/.config/x11/xinitrc

notify(){ dunstify -h string:x-dunst-stack-tag:sxhkd "$1"; }

startPrgm(){
	if [ -f "$configLoc" ]; then
		pgrep "$prgm" && killall "$prgm"
		{ "$prgm" -c "$configLoc" & } &&
		notify "Restarting $prgm"
	else
		notify "Config file not found" "$prmg"
	fi
}

iclr="sed '/#/d; /^[[:space:]]*$/d'"
createConfig(){
	case "$1" in
		-oa) eval $iclr $bspwmKey $myBspwmBinds $myKey ;;
		-a) eval $iclr $bspwmKey $myBspwmBinds $myKey > $configLoc;;
		-om) eval $iclr $myKey ;;
		-m) eval $iclr $myKey > $configLoc;;
	esac
}

if ( grep -q bspwm "$xLoc" ); then
	if ( createConfig -oa | diff -q - "$configLoc" ); then
		:
	else
		createConfig -a
	fi
else
	if ( createConfig -om | diff -q - "$configLoc" ); then
		:
	else
		createConfig -m
	fi

fi

if [ -f "$configLoc" ]; then
	pgrep "$prgm" && killall "$prgm"
	{ "$prgm" -c "$configLoc" & } &&
	notify "Restarting $prgm"
else
	notify "Config file not found" "$prmg"
fi
