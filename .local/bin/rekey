#!/bin/sh

PRGM="sxhkd"

LOC="$HOME"/.config/sxhkd
BSPWMKEY="$LOC"/bspwmhotkeys
MYBSPWMBINDS="$LOC"/myBspwmBinds
MYKEY="$LOC"/mybinds

CONFIGLOC="$LOC"/.sxhkdrc

XLOC="$HOME"/.config/x11/xinitrc

notify(){ dunstify -h string:x-dunst-stack-tag:sxhkd "$1"; }

startPrgm(){
	if [ -f "$CONFIGLOC" ]; then
		pgrep "$PRGM" && killall "$PRGM"
		{ "$PRGM" -c "$CONFIGLOC" & } &&
		notify "Restarting $PRGM"
	else
		notify "Config file not found" "$PRGM"
	fi
}

ICLR="sed '/#/d; /^[[:space:]]*$/d'"
createConfig(){
	case "$1" in
		-oa) eval $ICLR $BSPWMKEY $MYBSPWMBINDS $MYKEY ;;
		-a) eval $ICLR $BSPWMKEY $MYBSPWMBINDS $MYKEY > $CONFIGLOC;;
		-om) eval $ICLR $MYKEY ;;
		-m) eval $ICLR $MYKEY > $CONFIGLOC;;
	esac
}

if [ -f "$CONFIGLOC" ]; then
	touch $CONFIGLOC
fi

if ( grep -q bspwm "$XLOC" ); then
	if ( createConfig -oa | diff -q - "$CONFIGLOC" ); then
		:
	else
		createConfig -a
	fi
else
	if ( createConfig -om | diff -q - "$CONFIGLOC" ); then
		:
	else
		createConfig -m
	fi

fi

if [ -f "$CONFIGLOC" ]; then
	pgrep "$PRGM" && killall "$PRGM"
	{ "$PRGM" -c "$CONFIGLOC" & } &&
	notify "Restarting $PRGM"
else
	notify "Config file not found" "$PRGM"
fi
