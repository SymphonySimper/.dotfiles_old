#!/bin/sh

LOC=/etc/hosts
BLOCKSOURCE="$HOME"/.local/share/.begone
PERM='doas'
TEMPFILE=$(mktemp)

errorMsg(){ echo "$(syl r; syl B)${1}$(syl R)"; }

if grep -q '^# MY BLOCK' $LOC; then
	if grep -q '^# MY END BLOCK' $LOC; then
		$PERM sed '/^# MY BLOCK/, /^# MY END BLOCK/ { /^# MY BLOCK/! { /^# MY END BLOCK/!d; }}' -i $LOC
	else
		errorMsg "MY END BLOCK is absent"
	fi
else
	errorMsg 'MY BLOCK is absent'
fi

sort $BLOCKSOURCE -o $BLOCKSOURCE
for LINE in $( cat $BLOCKSOURCE ); do echo "0.0.0.0\t\t$LINE" >> $TEMPFILE; done
$PERM sed '/^# MY BLOCK/ r /dev/stdin' -i $LOC  < $TEMPFILE
