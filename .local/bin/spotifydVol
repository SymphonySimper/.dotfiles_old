#!/bin/sh

iconPath="$HOME/.local/share/icons/brands/spotify.svg"
warningI="$HOME/.local/share/icons/general/warning.svg"
getId=$(pulsemixer --list-sinks | awk '/librespot/ {print $4}' |  sed -e 's/[a-zA-Z]//g' -e 's/[<>,-]//g')

lazy="pulsemixer --id $getId"
getMute=$($lazy --get-mute)
lazyNot="dunstify -h string:x-dunst-stack-tag:spotifydVol"
getVol(){ $lazy --get-volume | awk '{print $1}'; }

notify(){
	case "$1" in
		-c) $lazyNot -i $iconPath "Volume: $(getVol)" -h int:value:$(getVol) ;;
		-m) $lazyNot -i $iconPath "$( [ $getMute -eq 0 ] && echo "Muted" || echo "Unmuted")" ;;
	esac
}

changeVol(){ 
	if [ $getMute -eq 0 ];then
		$lazy --change-volume $1 && notify -c
	else
		$lazyNot -i $warningI "Spotifyd is muted" "unmute to change volume"
	fi
}

toggleMute(){ $lazy --toggle-mute; }

case "$1" in
	-u) changeVol +2 ;;
	-d) changeVol -2 ;;
	-m) toggleMute && notify -m;;
esac
