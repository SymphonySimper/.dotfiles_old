#!/bin/sh

#Apps
iv="$IMAGE_VIEWER"
vv="$VIDEO_PLAYER"
vf="ffplay"
pv="$READER"
te="$EDITOR"
h="devour"
dis="fzf"

#Paths
what_img="$HOME/dl/What"*

sed_1="sed 's|[@*]||g'"
sed_2="sed 's|\\$|\\\\$|g'"
main() {
	case "$1" in
		*.jp*g | *.png | *.webp ) $h $iv "$1" ;;
		*.mkv | *.mp4 | *.webm | *.gif | *.avi | *youtu* | *.mp3 ) $h prime-run $vv "$1" ;;
		*.pdf ) $h $pv "$1" ;;
		-a) ls | grep  'jpeg\|jpg\|png\|webp' | $h $iv -t - ;;
		-w) $h $iv $what_img ;;
		-f) $h $vf /dev/video0 ;;
		-d) shift; case "$1" in
				*.pdf ) $h $pv "$1" && rm -i "$1" ;;
				*) $h $iv $what_img && rm -I $what_img ;;
			esac ;;
		-p) ls *.pdf | $dis | xargs -rI {} $h $pv {} ;;
		*) [ -n "$@" ] && $te "$1" ;;
	esac
}

if [ -n "$1" ]; then
	case "$1" in
		-x) shift
			query="$(ls -aF "$1" | grep -v / | eval $sed_1 | $dis | eval $sed_2)"
			[ -n "$query" ] && main "${1}/${query}"
			;;
		*) main "$(echo $@ | eval $sed_2)" ;;
	esac
else
	main "$(ls -aF | grep -v / | eval $sed_1 | $dis | eval $sed_2)"
fi
